// CHANGE 1: Replace computeAndUpdate function
// Find: function computeAndUpdate(){ ... }
function computeAndUpdate(){
  const total = Number(totalEl.value);
  const current = Number(currentEl.value);

  // Enhanced validation with detailed error messages
  if (!totalEl.value || !currentEl.value){
    setMessage('📝 Please fill in both fields to calculate progress.', true);
    return;
  }
  if (!Number.isFinite(total) || !Number.isFinite(current)){
    setMessage('⚠️ Please enter valid numbers only.', true);
    return;
  }
  if (total < 1){
    setMessage('📖 Total pages must be at least 1.', true);
    return;
  }
  if (current < 0){
    setMessage('⚠️ Current page cannot be negative.', true);
    return;
  }
  if (current > total){
    setMessage('⚠️ Current page cannot exceed total pages.', true);
    // Auto-correct: cap current at total
    currentEl.value = total;
    return;
  }
  
  // Calculate remaining pages
  const remaining = total - current;
  updateProgressUI(total, current, remaining);
}

// CHANGE 2: Update updateProgressUI signature
// Find: function updateProgressUI(total, current){
function updateProgressUI(total, current, remaining){
  if (total <= 0) {
    percentLabel.textContent = '0%';
    fillEl.style.width = '0%';
    fillEl.className = 'progress-fill';
    pageSummaryEl.textContent = '0 / 0';
    return;
  }
  let raw = (current / total) * 100;
  let pct = clamp(Math.round(raw * 10)/10, 0, 100);
  percentLabel.textContent = pct + '%';
  fillEl.style.width = pct + '%';
  pageSummaryEl.textContent = `${current} / ${total} (${remaining} left)`;

  fillEl.classList.remove('low','mid','high');
  if (pct < 25) fillEl.classList.add('low');
  else if (pct < 75) fillEl.classList.add('mid');
  else fillEl.classList.add('high');

  // Enhanced messages with page estimates
  if (pct === 100) setMessage("📚 Completed! Time for tea and reflection.", false);
  else if (pct >= 75) setMessage(`📖 Almost there — ${remaining} pages to go!`, false);
  else if (pct >= 50) setMessage(`📚 Halfway mark — ${remaining} pages remaining.`, false);
  else if (pct > 0) setMessage(`📝 ${remaining} pages ahead — enjoy the journey!`, false);
  else setMessage("🌟 Ready to begin — let the story unfold!", false);
}
